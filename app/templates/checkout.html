{% extends "base_template.html" %}
{% block title %}Profile{% endblock %}
{% block content %}
{% load static %}

<section id="form"><!--form-->
		<div class="container">
			<div class="row">
				<h1>Your cart</h1>
				<!-- <p>{{ user }}</p> -->
				{% if order.ref_code %}


				<div class="companyinfo" >
					<h2>
						{% if messages %}
							<span >
								<div id="cart_messages">{% for message in messages %}
									{{ message }}
									{% endfor %}</div>
							</span>
						{% endif %}
					</h2>
				</div>
				<br>
				<div class="cart_summary" id="cart_summary">
					<form method="POST" id="post-form">
						{% csrf_token %} <!--{{ cart_item_form }} -->
						<table>
						{% for item in order.get_cart_items %}
							<tr>
								<td><img src="{{ item.product.image.url }}"/></td>
								<td>{{ item.product.name }}</td>
								<td>
								<div onclick="decreaseValue{{ item.id }}()" class="btn btn-default" value="-" id="decrease{{ item.id }}">-</div><input type="text" required
		   minlength="1" maxlength="3" size="2" value="{{ item.amount }}" id="item{{ item.id }}"><div onclick="increaseValue{{ item.id }}()" class="btn btn-default" value="+" id="increase{{ item.id }}">+</div>
								</td>
								{% if item.amount > 1 %}
								<td class="cart_summary_money">{{ item.get_item_total }}<br><span>{{ item.product.price }} apiece</span></td>
								{% else %}
								<td class="cart_summary_money">{{ item.product.price }}</td>
								{% endif %}
								<td></td>
							</tr>
							{% endfor %}
							<tr>
								<td></td>
								<td></td>
								<td style="text-align:right;padding-right:0px;">To pay:</td>
								<td class="cart_summary_money">{{ order.get_cart_total }}</td>
								<td></td>
							</tr>
						</table>
					</form>
				</div>
				{% else %}
				<p>Your cart is empty</p>
				{% endif %}
			</div>
		</div>
	</section><!--/form-->
<script type="text/javascript">
setTimeout(function() {
    $('#cart_messages').fadeOut(3000);
}, 5000);

{% for item in order.get_cart_items %}
	function increaseValue{{ item.id }}() {
		  var value = parseInt(document.getElementById('item{{ item.id }}').value, 10);
		  value = isNaN(value) ? 0 : value;
		  value++;
		  document.getElementById('item{{ item.id }}').value = value;
	}

	function decreaseValue{{ item.id }}() {
	  var value = parseInt(document.getElementById('item{{ item.id }}').value, 10);
	  value = isNaN(value) ? 0 : value;
	  value < 1 ? value = 1 : '';
	  value--;
	  document.getElementById('item{{ item.id }}').value = value;
	}
	$('#item{{ item.id }}').on('change', function() {
		console.log("Item{{ item.id }} value changed to " + document.getElementById('item{{ item.id }}').value);
		var value = document.getElementById('item{{ item.id }}').value
		if (value < 1 || !isNumeric(value))  {
			document.getElementById('item{{ item.id }}').value = 1
		}
		else if (value > 30){
			document.getElementById('item{{ item.id }}').value = 30
		}
	});

	$('#increase{{ item.id }}').click(function() {
		var value = document.getElementById('item{{ item.id }}').value
		console.log("Item{{ item.id }} value increased to " + document.getElementById('item{{ item.id }}').value);
		if (value > 30){
			document.getElementById('item{{ item.id }}').value = 30
		}
	});

	$('#decrease{{ item.id }}').click(function() {
		console.log("Item{{ item.id }} value decreased to " + document.getElementById('item{{ item.id }}').value);
	});
{% endfor %}
function isNumeric(n) {
	return !isNaN(parseFloat(n)) && isFinite(n);
}
</script>

{% endblock %}